<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://jxxcarlson.github.io/docs-scripta-compiler/dataStructures/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Data structures - Scripta Compiler Docs</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Data structures";
        var mkdocs_page_input_path = "dataStructures.md";
        var mkdocs_page_url = "/docs-scripta-compiler/dataStructures/";
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Scripta Compiler Docs
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../introduction/">Introduction</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../overview/">Overview</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../common-code/">Common code</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">Data structures</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#primitive-blocks">Primitive Blocks</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#expressions">Expressions</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#expression-blocks">Expression Blocks</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#edit-records">Edit records</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#accumulator">Accumulator</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../render/">Rendering</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../l0-parser/">L0 Parser</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../lx-parser/">microLaTeX Parser</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../mkdocs/">Mkdocs</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Scripta Compiler Docs</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>Data structures</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="data-structures">Data Structures</h1>
<p>The primary data structures of the parser are</p>
<ol>
<li>Primitive Blocks (<code>PrimitiveBlock</code>)</li>
<li>Expressions (<code>Expr</code>)</li>
<li>Expression blocks (<code>ExpressionBlock</code>)</li>
<li>Accumulator (<code>Accumlator</code>)</li>
</ol>
<p>The parser first breaks source text into primitive
blocks (1), then maps the internal language parser over 
a list of primitive blocks to produce expression
blocks (2).</p>
<h2 id="primitive-blocks">Primitive Blocks</h2>
<p>Blocks have the rather elaborate type listed below.<br />
This complex structure is necessary for interactive
real-time editing with error recovery.  By real-time we mean
that the rendered text is updated "instantaneously"
in the browser as the user types in text.  By interactive,
we mean (for example) that click on the rendered text
brings the associated source text into view while
simultaneously highlighting it.  In addition, if the
user selects a block of source text and presses
ctrl-S (S for 'sync'), the corresponding rendered text
is brought into view and highlighted.</p>
<p>In the case of L0 and XMarkdown, a primitive
block is defined by</p>
<pre><code>type alias PrimitiveBlock =
{ indent : Int
, lineNumber : Int
, position : Int
, content : List String
, name : Maybe String
, args : List String
, properties : Dict String String
, sourceText : String
, blockType : PrimitiveBlockType
, error : Maybe { error : String }
}
</code></pre>
<p>In the case of
MicroLaTeX, there are two additional fields,
<code>level: Int</code> and <code>status: Status</code>.</p>
<h2 id="expressions">Expressions</h2>
<pre><code class="language-text">-- Parser.Expr
type Expr
    = Fun String (List Expr) Meta
    | Text String Meta
    | Verbatim String String Meta
</code></pre>
<h2 id="expression-blocks">Expression Blocks</h2>
<pre><code>-- Parser.Block
type ExpressionBlock
    = ExpressionBlock
        { name : Maybe String
        , args : List String
        , properties : Dict String String
        , indent : Int
        , lineNumber : Int
        , numberOfLines : Int
        , id : String
        , tag : String
        , blockType : BlockType
        , content : Either String (List Expr)
        , messages : List String
        , sourceText : String
        , error : Maybe { error : String }
        }
</code></pre>
<h2 id="edit-records">Edit records</h2>
<pre><code>-- Compiler.AbstractDifferentialCompiler
type alias EditRecord chunk parsedChunk accumulator =
    { chunks : List chunk
    , parsed : List parsedChunk
    , tree : List (Tree parsedChunk)
    , accumulator : accumulator
    , lang : Language
    , messages : List String
    , initialData : InitialData
    }
</code></pre>
<h2 id="accumulator">Accumulator</h2>
<p>The <code>Accumulator</code> type, defined in module <code>Compiler.Acc</code>,
is used to collect, build up, 
and apply auxiliary information about the text.
For example, the <code>headingIndex</code> stores the current
section number, where "current" refers to the 
the current section of the document as the 
accumulator-building function walks through
the current parse forest.  As it does, it simultaneously
(1) updates the accumulator and (2) applies new "patches" 
of the accumulator to the parse forest.  </p>
<p>This process is managed by
function <code>transformAccumulateTree</code> which is called every time 
the parser pipeline runs.  For this reason one does not have
to recompile to have up-to-date cross-references, etc., as
in standard LaTeX.</p>
<pre><code class="language-text">transformAccumulateTree : Tree ExpressionBlock -&gt; Accumulator -&gt; ( Accumulator, Tree ExpressionBlock )
transformAccumulateTree tree acc =
    Tree.mapAccumulate transformAccumulateBlock acc tree
</code></pre>
<p>where the function <code>transformAccumulateBlock</code> carries out the 
per-block step:</p>
<pre><code class="language-text">transformAccumulateBlock : Accumulator -&gt; ExpressionBlock -&gt; ( Accumulator, ExpressionBlock )
</code></pre>
<p>This function in turn calls upon functions <code>updateAccumulator</code> for (1) and 
function <code>transformBlock</code> for (2):</p>
<pre><code class="language-text">updateAccumulator : ExpressionBlock -&gt; Accumulator -&gt; Accumulator
</code></pre>
<pre><code class="language-text">transformBlock : Accumulator -&gt; ExpressionBlock -&gt; ExpressionBlock
</code></pre>
<pre><code class="language-text">-- Compiler.Acc
type alias Accumulator =
    { language : Language
    , headingIndex : Vector
    , documentIndex : Vector
    , counter : Dict String Int
    , blockCounter : Int
    , itemVector : Vector -- Used for section numbering
    , numberedItemDict : Dict String { level : Int, index : Int }
    , numberedBlockNames : List String
    , inList : Bool
    , reference : Dict String { id : String, numRef : String }
    , terms : Dict String TermLoc
    , footnotes : Dict String TermLoc
    , footnoteNumbers : Dict String Int
    , mathMacroDict : Parser.MathMacro.MathMacroDict
    , textMacroDict : Dict String Macro
    , keyValueDict : Dict String String
    , qAndAList : List ( String, String )
    , qAndADict : Dict String String
    }
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../common-code/" class="btn btn-neutral float-left" title="Common code"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../render/" class="btn btn-neutral float-right" title="Rendering">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../common-code/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../render/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
